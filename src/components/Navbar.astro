---
import FlowerFigure from './FlowerFigure.astro'

const links = [
    { name: '기술', href: '#stack' },
    { name: '프로젝트', href: '#projects' },
    { name: '블로그', href: '#blog' },
]
---

<nav
    class="sticky top-3 z-50 mx-auto max-w-fit p-2 rounded-full bg-neutral-300/30 backdrop-blur-md transition-all duration-100"
>
    <div class="flex justify-center items-center">
        <ul class="flex gap-2 font-medium">
            <li>
                <a
                    href="#home"
                    aria-label="맨 위로"
                    class="nav-link flex items-center justify-center w-10 h-10 text-theme rounded-full cursor-pointer transition-all duration-300 hover:bg-white/50 data-[active=true]:bg-white data-[active=true]:text-base-black"
                >
                    <FlowerFigure />
                </a>
            </li>
            {
                links.map((link) => (
                    <li>
                        <a
                            href={link.href}
                            aria-label={`${link.name} 섹션 보기`}
                            class="
                                nav-link block px-4 py-2 rounded-full cursor-pointer transition-all duration-300
                                hover:bg-white/50 hover:text-theme text-neutral-600 data-[active=true]:bg-white data-[active=true]:text-base-black"
                        >
                            {link.name}
                        </a>
                    </li>
                ))
            }
        </ul>
    </div>
</nav>

<script>
    const sections = document.querySelectorAll('section')
    const navLinks = document.querySelectorAll('.nav-link')

    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    navLinks.forEach((link) => {
                        link.setAttribute('data-active', 'false')
                    })

                    const id = entry.target.getAttribute('id')
                    const activeLink = document.querySelector(`.nav-link[href="#${id}"]`)

                    if (activeLink) {
                        activeLink.setAttribute('data-active', 'true')
                    }
                }
            })
        },
        {
            threshold: 0.5,
        }
    )

    sections.forEach((section) => {
        observer.observe(section)
    })
</script>
